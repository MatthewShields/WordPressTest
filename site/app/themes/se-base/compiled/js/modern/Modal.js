const s=class{constructor(s){this.s=s,this.triggers=Array.prototype.slice.call(document.querySelectorAll("["+this.s.modal_id_attr+'="'+this.s.modal.getAttribute("id")+'"]')),this.modal_close_button=this.s.modal.querySelectorAll(this.s.close_button)[0],this.focusable_elems=[],this.last_focussed_elem=!1,this.body=document.getElementsByTagName("body")[0],this.open_modal=this.open_modal.bind(this),this.close_modal=this.close_modal.bind(this),this.find_focusable_elements=this.find_focusable_elements.bind(this),this.trap_focus=this.trap_focus.bind(this),this.handle_keypress=this.handle_keypress.bind(this),this._init_events()}_init_events(){for(let s=0;s<this.triggers.length;s++)this.triggers[s].onclick=this.open_modal;this.modal_close_button.onclick=this.close_modal}trap_focus(s){this.s.modal.contains(s.target)?this.last_focussed_elem=s.target:this.last_focussed_elem===this.focusable_elems[0]?(this.focusable_elems[this.focusable_elems.length-1].focus(),this.last_focussed_elem=this.focusable_elems[this.focusable_elems.length-1]):this.last_focussed_elem===this.focusable_elems[this.focusable_elems.length-1]&&(this.focusable_elems[0].focus(),this.last_focussed_elem=this.focusable_elems[0])}open_modal(s){this.body.classList.add(this.s.body_class),this.clicked_trigger=s.target,this.s.modal.parentNode.classList.contains(this.s.backdrop_class)?this.backdrop_node=this.s.modal.parentNode:(this.backdrop_node=document.createElement("div"),this.backdrop_node.className=this.s.backdrop_class,this.s.modal.parentNode.insertBefore(this.backdrop_node,this.s.modal),this.backdrop_node.appendChild(this.s.modal)),this.backdrop_node.onclick=this.close_modal,this.backdrop_node.classList.add(this.s.backdrop_active_class),this.s.modal.classList.remove(this.s.modal_hidden_class),this.focusable_elems=[],this.find_focusable_elements(this.s.modal),document.addEventListener("keyup",this.handle_keypress),this.focusable_elems.length>0&&(document.addEventListener("focus",this.trap_focus,!0),this.focusable_elems[0].focus(),this.last_focussed_elem=this.focusable_elems[0])}close_modal(s){!0!==s&&s.target!==this.backdrop_node&&s.target!==this.modal_close_button||(this.body.classList.remove(this.s.body_class),this.backdrop_node.classList.remove(this.s.backdrop_active_class),this.s.modal.classList.add(this.s.modal_hidden_class),document.removeEventListener("focus",this.trap_focus,!0),document.removeEventListener("keyup",this.handle_keypress),this.clicked_trigger.focus())}handle_keypress(s){27===(s.which||s.keyCode)&&(s.stopPropagation(),this.close_modal(!0))}find_focusable_elements(s){for(var e=0;e<s.childNodes.length;e++){const t=s.childNodes[e];if("#text"!==t.nodeName){let s=this._attempt_focus(t);s&&this.focusable_elems.push(s),t.childNodes.length>0&&this.find_focusable_elements(t)}}}_attempt_focus(s){try{s.focus()}catch(s){}return document.activeElement===s&&s}};export default s;const e=document.querySelectorAll(".modal");for(let t=0;t<e.length;t++)new s({modal:e[t],modal_id_attr:"data-modal-id",modal_hidden_class:"hidden",backdrop_class:"dialog-backdrop",backdrop_active_class:"active",close_button:".modal-close",body_class:"has-modal"});