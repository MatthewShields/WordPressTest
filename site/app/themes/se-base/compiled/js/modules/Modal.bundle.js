"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var o=t[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(s){var o={};function l(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,l),t.l=!0,t.exports}l.m=s,l.c=o,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)l.d(s,o,function(e){return t[e]}.bind(null,o));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l(l.s=8)}({8:function(e,t,s){s.r(t);var o=function(){function t(e){_classCallCheck(this,t),this.s=e,this.triggers=Array.prototype.slice.call(document.querySelectorAll("["+this.s.modal_id_attr+'="'+this.s.modal.getAttribute("id")+'"]')),this.modal_close_button=this.s.modal.querySelectorAll(this.s.close_button)[0],this.focusable_elems=[],this.last_focussed_elem=!1,this.body=document.getElementsByTagName("body")[0],this.open_modal=this.open_modal.bind(this),this.close_modal=this.close_modal.bind(this),this.find_focusable_elements=this.find_focusable_elements.bind(this),this.trap_focus=this.trap_focus.bind(this),this.handle_keypress=this.handle_keypress.bind(this),this._init_events()}return _createClass(t,[{key:"_init_events",value:function(){for(var e=0;e<this.triggers.length;e++)this.triggers[e].onclick=this.open_modal;this.modal_close_button.onclick=this.close_modal}},{key:"trap_focus",value:function(e){this.s.modal.contains(e.target)?this.last_focussed_elem=e.target:this.last_focussed_elem===this.focusable_elems[0]?(this.focusable_elems[this.focusable_elems.length-1].focus(),this.last_focussed_elem=this.focusable_elems[this.focusable_elems.length-1]):this.last_focussed_elem===this.focusable_elems[this.focusable_elems.length-1]&&(this.focusable_elems[0].focus(),this.last_focussed_elem=this.focusable_elems[0])}},{key:"open_modal",value:function(e){this.body.classList.add(this.s.body_class),this.clicked_trigger=e.target,this.s.modal.parentNode.classList.contains(this.s.backdrop_class)?this.backdrop_node=this.s.modal.parentNode:(this.backdrop_node=document.createElement("div"),this.backdrop_node.className=this.s.backdrop_class,this.s.modal.parentNode.insertBefore(this.backdrop_node,this.s.modal),this.backdrop_node.appendChild(this.s.modal)),this.backdrop_node.onclick=this.close_modal,this.backdrop_node.classList.add(this.s.backdrop_active_class),this.s.modal.classList.remove(this.s.modal_hidden_class),this.focusable_elems=[],this.find_focusable_elements(this.s.modal),document.addEventListener("keyup",this.handle_keypress),0<this.focusable_elems.length&&(document.addEventListener("focus",this.trap_focus,!0),this.focusable_elems[0].focus(),this.last_focussed_elem=this.focusable_elems[0])}},{key:"close_modal",value:function(e){!0!==e&&e.target!==this.backdrop_node&&e.target!==this.modal_close_button||(this.body.classList.remove(this.s.body_class),this.backdrop_node.classList.remove(this.s.backdrop_active_class),this.s.modal.classList.add(this.s.modal_hidden_class),document.removeEventListener("focus",this.trap_focus,!0),document.removeEventListener("keyup",this.handle_keypress),this.clicked_trigger.focus())}},{key:"handle_keypress",value:function(e){27===(e.which||e.keyCode)&&(e.stopPropagation(),this.close_modal(!0))}},{key:"find_focusable_elements",value:function(e){for(var t=0;t<e.childNodes.length;t++){var s=e.childNodes[t];if("#text"!==s.nodeName){var o=this._attempt_focus(s);o&&this.focusable_elems.push(o),0<s.childNodes.length&&this.find_focusable_elements(s)}}}},{key:"_attempt_focus",value:function(e){try{e.focus()}catch(e){}return document.activeElement===e&&e}}]),t}();t.default=o;for(var l=document.querySelectorAll(".modal"),i=0;i<l.length;i++)new o({modal:l[i],modal_id_attr:"data-modal-id",modal_hidden_class:"hidden",backdrop_class:"dialog-backdrop",backdrop_active_class:"active",close_button:".modal-close",body_class:"has-modal"})}});
//# sourceMappingURL=Modal.bundle.js.map
